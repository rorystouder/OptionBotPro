<div class="container mt-5">
  <div class="text-center mb-5">
    <h1 class="display-4 mb-3">Choose Your Trading Plan</h1>
    <p class="lead text-muted">Start your automated options trading journey with OptionBotPro</p>
    
    <% if current_user&.on_trial? %>
      <div class="alert alert-info">
        <strong>üéâ You're on a free trial!</strong> 
        <%= pluralize(current_user.days_until_trial_ends, 'day') %> remaining.
      </div>
    <% end %>
  </div>

  <div class="row g-4 justify-content-center">
    <% @tiers.each_with_index do |tier, index| %>
      <div class="col-lg-4 col-md-6">
        <div class="card h-100 <%= 'border-success' if tier.pro_tier? %> <%= 'shadow-lg' if tier.pro_tier? %>">
          <% if tier.pro_tier? %>
            <div class="card-header bg-success text-white text-center">
              <small class="fw-bold">‚≠ê MOST POPULAR</small>
            </div>
          <% end %>
          
          <div class="card-body d-flex flex-column">
            <div class="text-center mb-4">
              <h3 class="card-title"><%= tier.name %></h3>
              <div class="mb-2">
                <span class="h2 fw-bold">$<%= tier.price_monthly.to_i %></span>
                <span class="text-muted">/month</span>
              </div>
              <p class="text-muted small"><%= tier.description %></p>
            </div>

            <ul class="list-unstyled mb-4 flex-grow-1">
              <% tier.features_list.each do |feature| %>
                <li class="mb-2">
                  <i class="bi bi-check-circle-fill text-success me-2"></i>
                  <%= feature %>
                </li>
              <% end %>
            </ul>

            <div class="mt-auto">
              <% if current_user %>
                <% if @current_user_tier == tier %>
                  <button class="btn btn-outline-success w-100" disabled>
                    Current Plan
                  </button>
                <% else %>
                  <%= button_to "Choose #{tier.name}", subscribe_path(tier), 
                      method: :post, 
                      class: "btn #{'btn-success' if tier.pro_tier?} #{'btn-outline-primary' unless tier.pro_tier?} w-100" %>
                <% end %>
              <% else %>
                <%= link_to "Get Started", signup_path, 
                    class: "btn #{'btn-success' if tier.pro_tier?} #{'btn-outline-primary' unless tier.pro_tier?} w-100" %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="row mt-5">
    <div class="col-lg-8 mx-auto">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title text-center mb-4">üõ°Ô∏è All Plans Include Our Safety Features</h4>
          <div class="row">
            <div class="col-md-6">
              <ul class="list-unstyled">
                <li class="mb-2"><i class="bi bi-shield-check text-success me-2"></i>25% Cash Reserve Protection</li>
                <li class="mb-2"><i class="bi bi-shield-check text-success me-2"></i>Daily Loss Limits</li>
                <li class="mb-2"><i class="bi bi-shield-check text-success me-2"></i>Emergency Stop Function</li>
              </ul>
            </div>
            <div class="col-md-6">
              <ul class="list-unstyled">
                <li class="mb-2"><i class="bi bi-shield-check text-success me-2"></i>Encrypted Credential Storage</li>
                <li class="mb-2"><i class="bi bi-shield-check text-success me-2"></i>TastyTrade Integration</li>
                <li class="mb-2"><i class="bi bi-shield-check text-success me-2"></i>Risk Management First</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="text-center mt-5">
    <h5>Questions about pricing?</h5>
    <p class="text-muted">All plans come with a 14-day free trial. No credit card required to start.</p>
    
    <% unless current_user %>
      <div class="mt-4">
        <%= link_to "Start Free Trial", signup_path, class: "btn btn-success btn-lg me-3" %>
        <%= link_to "Login", login_path, class: "btn btn-outline-primary btn-lg" %>
      </div>
    <% end %>
  </div>
</div>
