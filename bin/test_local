#!/bin/bash
# Test if the app runs locally in production mode

echo "Testing production build locally..."

# Set environment
export RAILS_ENV=production
export RAILS_SERVE_STATIC_FILES=true
# Load from .env.production or generate with: bundle exec rails secret
export SECRET_KEY_BASE=${SECRET_KEY_BASE:-$(bundle exec rails secret)}
# export RAILS_MASTER_KEY=your_master_key_here

# Install production dependencies
echo "Installing dependencies..."
bundle install --without development test

# Precompile assets
echo "Precompiling assets..."
bundle exec rails assets:precompile

# Setup database
echo "Setting up database..."
bundle exec rails db:create
bundle exec rails db:migrate
bundle exec rails db:seed

# Start server
echo "Starting server on port 3000..."
bundle exec rails server -b 0.0.0.0 -p 3000